import React, { Component } from 'react';
import PropTypes from 'prop-types';

import './styles.css';

function findLinkEntities(contentBlock, callback, contentState) {
  contentBlock.findEntityRanges(
    (character) => {
      const entityKey = character.getEntity();
      return (
        entityKey !== null &&
        contentState.getEntity(entityKey).getType() === 'LINK'
      );
    },
    callback,
  );
}

function getLinkComponent(config) {
  const showOpenOptionOnHover = config.showOpenOptionOnHover;
  return class Link extends Component {
    static propTypes = {
      entityKey: PropTypes.string.isRequired,
      children: PropTypes.array,
      contentState: PropTypes.object,
    };

    state: Object = {
      showPopOver: false,
    };

    openLink: Function = () => {
      const { entityKey, contentState } = this.props;
      const { url } = contentState.getEntity(entityKey).getData();
      const linkTab = window.open(url, 'blank'); // eslint-disable-line no-undef
      linkTab.focus();
    };

    toggleShowPopOver: Function = () => {
      const showPopOver = !this.state.showPopOver;
      this.setState({
        showPopOver,
      });
    };

    render() {
      const { children, entityKey, contentState } = this.props;
      const { url, targetOption } = contentState.getEntity(entityKey).getData();
      const { showPopOver } = this.state;
      return (
        <span
          className="rdw-link-decorator-wrapper"
          onMouseEnter={this.toggleShowPopOver}
          onMouseLeave={this.toggleShowPopOver}
        >
          <a href={url} target={targetOption}>{children}</a>
          {showPopOver && showOpenOptionOnHover ?
            <img
              src={"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAGhAfQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iikJoAWkzSUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAGaXNJRQA6ikBpaACiiigAJxTc0NSUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5pQabRQA+igdKKAGd6KSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBwPFFNooASiiigBc0UlFAC0UmaWgAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAEooooAKKKKACiiigBc0UlFAC0UUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUANooooAKKKKACiiigAooooAKUGkooAdRTaWgBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBtFFFABRRRQAUUUUAFFFFABRRRQAUZoooAUGlptKDQAtFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUHgZNY194it7clLcec475+Ufj3oA2aK4qfXNQnJ/feWPSMY/XrVU312Tk3U+f+uhoA7+iuGi1a/hOVupD7Md3861rPxMchbuIY/vp/UUAdHRUcM0dxEJInDoehFSUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFADaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBQadmmUoNADqKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaRmCqWYgADJJ7UjMFUsxAAGST2rlNZ1k3jGCAkQA8n+/wD/AFqAF1jWmu2MFuxWAcEjq/8A9asWiigAorZsPD01ygkuG8mM8gY+Y/4Vqr4csAuD5pPqWoA5GiujuvDI2lrSYk/3JO/41z8sUkErRyoVdTgg0AWdP1GbT5t8Zyh+8h6Gu0tbmK7t1miOVb9PavP62PD98be8EDn93McfRu3+FAHXUUlFAC0UlFAC0UlFAC0UlFAC0UlFAC0UlFAC0UlFAC0UlFAC0UlFAC0UlFADaKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigABp1NooAdRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUjMFUsxAAGST2oZgqlmIAAySe1cnrOsm8YwQEiAHk/3/AP61ABrOsm8YwQEiAHk/3/8A61Y9FFABXSaLou3bdXS89UjPb3NGi6Lt23V0vPVIz29zXQ0AFFFFABWRr9gtzZm4Rf3sQzn1XuP61r011DRsrdCCDQB55SqSrBlOCDkGkooA9AtpfPtoph/Ggb8xUtUdGJOkW2f7uP1NXqACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAG5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5ozSUUALmjNJRQAuaM0lFAC5pQc02igB9FIDS5oAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKCQASTgCjNYXiK/MUS2kZw0gy5HZfT8aAKGs6wbtjbwEiAHk/3/wD61Y1FFABXSaLou3bdXS89UjPb3NJoui7dt1dLz1SM9vc10WaACijNGaACijNGaACqeqXQtNPlkJwxG1PqannuIraFpZW2ovU1xup6lJqM+4/LEv3E9P8A69AFGiirml2hvb+OPHyA7n+goA7DT4jDp1vGeCIxn696s0UZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0UAMooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKcDTaKAHUUgNLQAUUUUAFFFFABRRRQAVwupXBudRnlzkFiF+g4Fdw52xsR2BNee9aACtzw/pyzubqZcohwgPc+tYddppZjttFhd2CoE3MT780AXndY0LuwVQMkk4Aqh/bunb9vn/jsOP5Vz+ras9/JsTK26ngf3vc1mUAehI6yIHRgykZBByDTq5zwxcOXmtiSUA3r7c4NdHQAVHPPHbQtLKwVF6mieeO2haWVgqL1NcbqWpSahNk5WJfuJ6e596ADU9Tk1CbJysS/cT+p96o0U5EaR1RFLMxwAO9AAiNI6oilmY4AHeuy0jTRp9t82DM/Ln09qi0jSFsUEsoDXDDk/wB32FatABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKcDmm0UAOopAc0tABRRRQAUUUUABGQQehrz6RDHK8Z6qSp/CvQa5DXrU2+otIB8k3zD69/8+9AGXVmW+mltIrYtiKMdB3+tVqKAClAJIAGSegFABJAAyT2rqNH0cWwFxcLmY/dU/wf/XoAl0PTWsoWklGJZMcf3R6Vozzx20LSyttReppl1eQWce+eQL6DufoK5HUtSl1CbJysS/cT09z70AGpalJqE2TlYl+4n9T71RopyI0jhEUszHAA70ACI0jhEUszHAA711uk6StigllAa4Ycn+77CjSdJWxQSygNcMOT/d9hWpQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFADc0ZpKKAFzRmkooAXNGaSigBc0ZpKKAFzRmkooAXNGaSigBc0ZpKKAFzRmkooAXNGaSigBc0ZpKKAFzRmkooAXNGaSigBc0oOabTJZooE3yyJGo/idgB+tAE1FZw17SyxQXsTMP7uW/lUiavYOcC6Qf73H86ALtFNR0kXcjKynuDkUSSJFG0kjBUUZJPagAkkSKNpJGCooySe1chq2qHUJQqjEKH5Qep9zS6tqr38mxMrAp4H973NZlABRQASQAMk9BVi4srm1AM8LICOD2oAgBIIIJBHQip/t95tx9qmx/vmq9FACszOxZmLE9yc0lFWLWyuLx9sEZb1bsPqaAIURpHVEUszHAA711uk6StigllAa4Ycn+77CnaZpEVgN7EPORy3p9K0qACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAGUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUU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RmgAoozRmgAoozRmgApwb1puaM0ASUVGCRTgwNADqKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0UARUUrDDkehpKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAFBIpwYGmUUASUUwEilDetADqKQEGloAKKKKACiiigAooooAKKljTcufeigBlym2TPY1DV6WPzEI79qonIOD1oAKKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaKSigBaXJFNooAfuNG72plFAEm4Ubh61HRQBJketGRUdTW8e99x6CgC1Gu1AKKfRQAVBPBv+ZfvfzqeigDM6UVfkhWTnofUVVe3kTtke1AEVFHTrRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAoozRmgAopyoz/AHVJqeO17ufwFAEUUTSNx07mryqEUKOgoACjAGBS0AFFFFABRRRQAUUUUAQ3H3aonrRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFSw/eFFFAF4dBS0UUAFFFFABRRRQB/9k="}
              alt=""
              onClick={this.openLink}
              className="rdw-link-decorator-icon"
            />
            : undefined
          }
        </span>
      );
    }
  };
}

export default config => ({
  strategy: findLinkEntities,
  component: getLinkComponent(config),
});
